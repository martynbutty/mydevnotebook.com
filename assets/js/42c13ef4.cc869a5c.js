"use strict";(self.webpackChunkmydevnotebook_com=self.webpackChunkmydevnotebook_com||[]).push([[213],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(a),m=o,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||n;return a?r.createElement(h,s(s({ref:t},c),{},{components:a})):r.createElement(h,s({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,s=new Array(n);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:o,s[1]=i;for(var u=2;u<n;u++)s[u]=a[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1895:function(e,t,a){a.r(t),a.d(t,{assets:function(){return l},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return n},metadata:function(){return i},toc:function(){return u}});var r=a(3117),o=(a(7294),a(3905));const n={title:"Aurora Serverless Backup Configuration",description:"Considerations and costs of backups of an Aurora database cluster",authors:["martyn"],hide_table_of_contents:!1},s=void 0,i={permalink:"/blog/2023/08/15/Aurora-backups",source:"@site/blog/2023-08-15-Aurora-backups/index.md",title:"Aurora Serverless Backup Configuration",description:"Considerations and costs of backups of an Aurora database cluster",date:"2023-08-15T00:00:00.000Z",formattedDate:"August 15, 2023",tags:[],readingTime:4.4,hasTruncateMarker:!0,authors:[{name:"Martyn Butterworth",title:"Technical Architect",url:"https://github.com/MartynButty",imageURL:"https://github.com/MartynButty.png",key:"martyn"}],frontMatter:{title:"Aurora Serverless Backup Configuration",description:"Considerations and costs of backups of an Aurora database cluster",authors:["martyn"],hide_table_of_contents:!1},nextItem:{title:"Aurora Serverless Database Selection",permalink:"/blog/2023/08/01/Aurora-Serverless-database-selection"}},l={authorsImageUrls:[void 0]},u=[{value:"Aurora backups",id:"aurora-backups",level:2},{value:"Costs of backups",id:"costs-of-backups",level:2},{value:"Cost examples",id:"cost-examples",level:3},{value:"Useful metrics",id:"useful-metrics",level:2},{value:"Backtrack",id:"backtrack",level:2},{value:"Summary",id:"summary",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In a previous article ",(0,o.kt)("a",{parentName:"p",href:"/blog/2023/08/01/Aurora-Serverless-database-selection"},"Aurora Serverless database selection"),", I discussed the high level considerations around selecting or upgrading to an Aurora server-less V2 database."),(0,o.kt)("p",null,"If you decided that Aurora V2 is the way to go for your needs, one important but sometimes overlooked aspect is disaster recovery (DR), and in particular the backup configuration of your database. The following discusses some of the main points for configuring backups of an Aurora server-less V2 database."),(0,o.kt)("p",null,(0,o.kt)("img",{src:a(7453).Z,width:"5000",height:"3760"})),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.freepik.com/free-photo/error-something-went-wrong-construction-concept_18122893.htm#query=data%20loss&position=20&from_view=search&track=country_rows_v2"},"Image by rawpixel.com")," on Freepik"),(0,o.kt)("h2",{id:"aurora-backups"},"Aurora backups"),(0,o.kt)("p",null,"AWS offers automated continuous backups from one to thirty five days. This period is known as the ",(0,o.kt)("strong",{parentName:"p"},"retention period"),"."),(0,o.kt)("p",null,"Automated backups store the information required to be able to restore the cluster to any point in time during the retention window. They are incremental and charged based on the amount of storage required for this restoration ability."),(0,o.kt)("p",null,"Database cluster snapshots are always a full backup of the cluster at the time it was taken."),(0,o.kt)("p",null,"You can retain data outside of the retention period by taking a manual snapshot. Manual snapshots do not expire, but they do incur extra costs as they are not included in the free storage allowance (see below)."),(0,o.kt)("h2",{id:"costs-of-backups"},"Costs of backups"),(0,o.kt)("p",null,"There is an amount of free storage (a.k.a. free tier) for backups:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"There's no charge for a one day retention period"),(0,o.kt)("li",{parentName:"ul"},"There's free storage (of backups) up to the value of the cluster volume size (",(0,o.kt)("inlineCode",{parentName:"li"},"VolumeBytesUsed")," in cloudwatch metrics)."),(0,o.kt)("li",{parentName:"ul"},"There's free unlimited storage for all snapshots that lie within the retention period (including manual snapshots).")),(0,o.kt)("p",null,"The backup storage includes all the incremental records stored to allow a restore to any point within the retention period. The minimum storage required will therefore always be the cluster size just before the retention period."),(0,o.kt)("p",null,"The total billed usage for automated backups will never exceed the cumulative cluster volume size over the retention period. For example, with a five day retention period of a 10GB cluster that didn't increase in size over the five days, you would never exceed 50GB (5 days X 10GB)."),(0,o.kt)("p",null,"For databases with lots of changes, the size of the automated backup grows over time. If a database slows or stops growing (i.e. stops experiencing changes), the size of the automated backups will decrease as the stored changes leave the retention window."),(0,o.kt)("p",null,"Manual snapshots, and AWS backup snapshots are chargeable when they fall outside of the retention period."),(0,o.kt)("h3",{id:"cost-examples"},"Cost examples"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Database start cluster size: 100GB"),(0,o.kt)("li",{parentName:"ul"},"Retention period: 10 days"),(0,o.kt)("li",{parentName:"ul"},"Daily database growth: 5GB ^1")),(0,o.kt)("p",null,"Calculated automated backup storage: ",(0,o.kt)("inlineCode",{parentName:"p"},"100GB [initial volume size] + (10 X 5GB) [size of incremental records] = 150GB total backsup usage")),(0,o.kt)("p",null,"Subtract the free tier Database cluster volume size at end: 125GB ^2"),(0,o.kt)("p",null,"Billed storage: ",(0,o.kt)("inlineCode",{parentName:"p"},"150GB [total storage required] - 125GB [latest volume size] = 25GB billed usage")),(0,o.kt)("p",null,"^1 It's probably unrealistic to assume any database would grow by the same amount every day, but I have here just to make the calculations simpler to understand"),(0,o.kt)("p",null,"^2 Simplified assumption that all inserts, updates and deletes result in this final volume size."),(0,o.kt)("p",null,"You are billed ",(0,o.kt)("strong",{parentName:"p"},"per GB month"),", as a weighted average over the month. Therefore if you used 100GB over 15 days and 0B for the other 15 days you'd be charged: ",(0,o.kt)("inlineCode",{parentName:"p"},"((100GB X 15 days) + (0B X 15 days)) / 30 = 50GB-month")),(0,o.kt)("p",null,"At the time of writing, backup costs $0.021 per GB-month, so the above example would cost just $1.05 for the backup storage."),(0,o.kt)("h2",{id:"useful-metrics"},"Useful metrics"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Metric"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"BackupRetentionPeriodStorageUsed")),(0,o.kt)("td",{parentName:"tr",align:null},"storage in bytes of cluster plus changes for the retention period.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"SnapshotStorageUsed")),(0,o.kt)("td",{parentName:"tr",align:null},"backup storage used in bytes for manual snapshots beyond the retention period of the automated backup period")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"TotalBackupStorageBilled")),(0,o.kt)("td",{parentName:"tr",align:null},"the ",(0,o.kt)("inlineCode",{parentName:"td"},"BackupRetentionPeriodStorageUsed")," + ",(0,o.kt)("inlineCode",{parentName:"td"},"SnapshotStorageUsed")," - ",(0,o.kt)("inlineCode",{parentName:"td"},"free tier"),". (free tier will be the latest recorded size of the cluster)")))),(0,o.kt)("p",null,"To get an idea of database growth, you can use AWS cost explorer:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Granularity: daily"),(0,o.kt)("li",{parentName:"ul"},"Services: RDS"),(0,o.kt)("li",{parentName:"ul"},"Usage type group: RDS: storage"),(0,o.kt)("li",{parentName:"ul"},"Tag: product -> team/product name")),(0,o.kt)("h2",{id:"backtrack"},"Backtrack"),(0,o.kt)("p",null,"Worthy of mention is ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Managing.Backtrack.html"},"Backtrack"),'. Backtrack allows you to "rewind" the DB to a specified time. Backtrack should NOT be used instead of backups, but to complement backups.'),(0,o.kt)("p",null,"Backtrack will only be available if it was enabled when your cluster was created, and has a limit of 72 hours as the max backtrack window. There is additional costs associated with backtrack."),(0,o.kt)("p",null,"For more info, please follow the link above."),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,"Your first step to configuring backups is to understand your database and application."),(0,o.kt)("p",null,"If a erroneous change was made to you data or schema that didn't get noticed for a few days, would you want to be able to restore to just before that point in time, or attempt to forward fix the data?"),(0,o.kt)("p",null,"How large is your database and how much does it grow each month?"),(0,o.kt)("p",null,"The combination of the above two points, should allow you to come up with some ballpark cost calculations, which should allow you to find a sweet spot of backup retention period vs cost optimisation."),(0,o.kt)("p",null,"Be cautious of selecting a backup retention period that optimises on cost of backups. If you had to spend a few days with multiple people trying to manually fix your data, that could easily (and significantly) outweigh any saving on the cost of backup storage."))}d.isMDXComponent=!0},7453:function(e,t,a){t.Z=a.p+"assets/images/error-something-went-wrong-construction-concept-1c173d06b0251b9bd3dc71b03a1bb01a.jpg"}}]);