<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Architecture/caching" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Caching Strategies (with a focus on microservices) | My Dev Notebook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.mydevnotebook.com/Architecture/caching"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Caching Strategies (with a focus on microservices) | My Dev Notebook"><meta data-rh="true" name="description" content="caching strategies, topologies, eviction strategies etc from a microservice perspective"><meta data-rh="true" property="og:description" content="caching strategies, topologies, eviction strategies etc from a microservice perspective"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.mydevnotebook.com/Architecture/caching"><link data-rh="true" rel="alternate" href="https://www.mydevnotebook.com/Architecture/caching" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.mydevnotebook.com/Architecture/caching" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Dev Notebook RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Dev Notebook Atom Feed">



<script src="https://www.googletagmanager.com/gtag/js?id=G-H8PHRNFHKD" async></script>
<script src="/ga.js"></script><link rel="stylesheet" href="/assets/css/styles.533a46bd.css">
<script src="/assets/js/runtime~main.427a8c0c.js" defer="defer"></script>
<script src="/assets/js/main.ac844c97.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/notebook.png" alt="My Dev Notebook Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/notebook.png" alt="My Dev Notebook Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Dev Notebook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Tech Articles</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Agile/scrum-cheatsheet">Agile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Architecture/Overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture/Overview">Architecture Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Architecture/caching">Caching Strategies (with a focus on microservices)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture/whyModernise">Why modernise legacy systems</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Artificial Intelligence/ai">Artificial Intelligence</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Design Patterns and Principles/adapter">Design Patterns and Principles</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/blog">Recent Blog Posts</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Caching Strategies (with a focus on microservices)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Caching Strategies (with a focus on microservices)</h1></header><h2 id="topologies">Topologies</h2>
<h3 id="distributed">Distributed</h3>
<p>A distributed cache is a client-server style cache. It is the cached data that is distributed, i.e. it&#x27;s distributed between
all the services that use it but there&#x27;s only a single cache server/service.</p>
<p><img alt="distributed cache diagram" src="/assets/images/distributed_cache-5a2b7a3d6e54686e6c7c0167257ca60d.png" width="431" height="321"></p>
<ul>
<li>Uses a separate server (e.g. redis or ignite etc)</li>
<li>All services using it use a client library to use the cache.</li>
<li>Each service does not have cached data; It has to access it from the server</li>
<li>Not fault tolerant, unless using a cluster</li>
</ul>
<p>The cache can store the data as</p>
<table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>IMDG</td><td>In Memory Data Grid - Simple</td></tr><tr><td>IMDB</td><td>In Memory DataBase - Can have a schema and thus be more complex, allows use of SQL like queries against the cached data</td></tr></tbody></table>
<h3 id="replicated">Replicated</h3>
<p>This type of caching topology requires no external server. The cached data resides in each service, in memory. The cache
engine takes care of replicating the cached data amongst all instances, so it has &quot;eventual consistency&quot;. Fewer products
offer this type of caching compared to <a href="#Distributed">Distributed</a>, including <a href="https://ignite.apache.org/">Ignite</a>,
<a href="https://hazelcast.com/use-cases/caching/">Hazelcast</a>, <a href="https://tanzu.vmware.com/gemfire">GemFire</a>,
<a href="https://www.oracle.com/middleware/technologies/coherence.html">Coherence</a> and
others.</p>
<p><img alt="replicated cache diagram" src="/assets/images/replicated_cache-f986aa7b4d7dc11d4ad5c45ba5b5c8b5.png" width="432" height="172"></p>
<p>Eventual consistency is a by-product of how the cache operates. E.g. after a &quot;put&quot; onto the cache, the cache engine updates
the other instances in the background. Some systems allow concepts like <code>syncput()</code> to force consistency, but this shouldn&#x27;t
usually be necessary. The data replication engine (e.g. ignite) maintains a socket level connection to the other instances.</p>
<blockquote>
<p>Beware of your cache size!</p>
<p>For example on a shared host running a kubernetes cluster, 30 instances each with a 200 MB cache requires 6 GB of data!.</p>
</blockquote>
<p>Similar to above, this topology is not viable if you have large and/or lots of storage and/or instances.</p>
<h3 id="near-cache">Near Cache</h3>
<p>The near cache hybrid is a combination of a distributed and replicated cache. Each service has its own in memory cache,
known as the <strong>front cache</strong> (or MRU, or MFU cache depending on the eviction strategy used - see later). There is also a
distributed cache holding the full data set, known as the <strong>full backing cache</strong>.</p>
<p><img alt="near cache diagram" src="/assets/images/near_cache-b74a392a60c595ba2216d1bef2191a6d.png" width="431" height="341"></p>
<ul>
<li>There are no communications between services for cache management like in a replicated cache, instead this is managed by
the backing cache.</li>
<li>It allows a large amount of cached data in the full (backing) cache</li>
<li>A smaller subset of data is stored in each service&#x27;s front cache which might use MRU or MFU.</li>
<li>Individual front cache&#x27;s can therefore contain different datasets to each other</li>
<li>It can suffer from inconsistent response times in some environments, especially in a microservice environment. This is
because the data might not exist in the local front cache, so we have to go to the backing cache, and maybe even all the
way to the database.</li>
</ul>
<h2 id="comparing-topologies">Comparing Topologies</h2>
<table><thead><tr><th></th><th>Replicated</th><th>Distributed</th><th>Near Cache</th></tr></thead><tbody><tr><td>optimisation</td><td>performance</td><td>consistency</td><td>balanced</td></tr><tr><td>cache Size</td><td>small (&lt;100 MB)</td><td>large (500 MB +)</td><td>large (500 MB +)</td></tr><tr><td>type of data</td><td>relatively static</td><td>transactional</td><td>relatively static</td></tr><tr><td>update frequency</td><td>relatively low</td><td>high</td><td>relatively low</td></tr><tr><td>fault tolerance</td><td>high</td><td>low</td><td>low</td></tr><tr><td>responsiveness</td><td>high</td><td>medium</td><td>variable</td></tr></tbody></table>
<h2 id="spaced-based-microservices">Spaced-based microservices</h2>
<p>A challenge of microservices, particularly in migrating to them from a monolith, is how each service has its own data and
does not require access to a large central shared database. If there were many services sharing the same database, attempting
to make a schema change to that database would require very careful choreography to prevent breaking any services (or more
likely, you simply wouldn&#x27;t be able to make the change without breaking something).</p>
<p>With caching you can share a single database in a microservice environment. You can even version database changes, increase
performance, use cloud based data sync but on-prem database, and still have simple reporting and data analytics.</p>
<p><img alt="spaced based cache diagram" src="/assets/images/space_based-8aa326f1f7da72a2f206508d981365b3.png" width="747" height="296"></p>
<p>All data is stored in memory using replicated caches. Each service&#x27;s cache is a sub-set of the data in the database, but
a full data set for that particular services needs. Even if you have large database that is not practical to cache (e.g.
2 TB), the data required for an individual microservice might only be 200 MB of that 2 TB.</p>
<h3 id="reading-from-the-database">Reading from the database</h3>
<p>Reads from the database can happen in the following circumstances</p>
<ul>
<li>An external application updates the database. An async data writer will (eventually) update the cache data in this case</li>
<li>Cold starts - i.e. no instance of the service is already running from which to clone the data. This could be because
we lost all instances, or needed to perform a schema change or redeploy etc</li>
<li>Archiving of data (so cache needs renewing/refreshing)</li>
</ul>
<h3 id="data-collisions">Data Collisions</h3>
<p>When two service instances are operating at the same time, data collisions can occur. For example in an inventory
system, both instance caches might have the same stock level for an item, and both perform separate operations to decrement
the stock by different amounts (e.g. for different orders) <em>at the same time</em>. This means the service that completes last,
overwrites the change made by the first services operation.</p>
<p>This can be mitigated by not updating local caches but by performing a put operation to a queue. An <code>inventory adjust</code> service
could then be created to read from this queue, apply each update in turn to itself and its own cache which would then replicate
to the other services as normal. The trade-off is the time to eventual consistency.</p>
<h2 id="cache-eviction-policies">Cache eviction policies</h2>
<h3 id="ttl">TTL</h3>
<p>Time to live, is a simple timeout parameter. It doesn&#x27;t address a full cache scenario</p>
<h3 id="arc">ARC</h3>
<p>Archive policy (ARC) evicts item based on date created (NOT when it was added to the cache). For example evict all items
older than 6 months. It doesn&#x27;t address a full cache scenario</p>
<h3 id="lfu">LFU</h3>
<p>Least frequently used. Items have an internal &quot;count&quot; of how often it is read. A put operation must reset this internal
count for all items (otherwise the item just added would most likely be evicted again), so this can be suboptimal.</p>
<h3 id="lru">LRU</h3>
<p>Least recently used. All items get an &quot;age&quot;. Oldest item gets evicted on put. On cache item hit, that individual items age
is set to zero and all other items ages are incremented. This is more effective than LFU, but more expensive because of
the re-aging process.</p>
<h3 id="rr">RR</h3>
<p>Random replacement. If doing a put on a full cache, then randomly evict an item. This can be a good initial strategy if
you don&#x27;t know much about you data / hotspots, or for when data access is inconsistent or non-deterministic.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Architecture/Overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Architecture Notes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Architecture/whyModernise"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Why modernise legacy systems</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#topologies" class="table-of-contents__link toc-highlight">Topologies</a><ul><li><a href="#distributed" class="table-of-contents__link toc-highlight">Distributed</a></li><li><a href="#replicated" class="table-of-contents__link toc-highlight">Replicated</a></li><li><a href="#near-cache" class="table-of-contents__link toc-highlight">Near Cache</a></li></ul></li><li><a href="#comparing-topologies" class="table-of-contents__link toc-highlight">Comparing Topologies</a></li><li><a href="#spaced-based-microservices" class="table-of-contents__link toc-highlight">Spaced-based microservices</a><ul><li><a href="#reading-from-the-database" class="table-of-contents__link toc-highlight">Reading from the database</a></li><li><a href="#data-collisions" class="table-of-contents__link toc-highlight">Data Collisions</a></li></ul></li><li><a href="#cache-eviction-policies" class="table-of-contents__link toc-highlight">Cache eviction policies</a><ul><li><a href="#ttl" class="table-of-contents__link toc-highlight">TTL</a></li><li><a href="#arc" class="table-of-contents__link toc-highlight">ARC</a></li><li><a href="#lfu" class="table-of-contents__link toc-highlight">LFU</a></li><li><a href="#lru" class="table-of-contents__link toc-highlight">LRU</a></li><li><a href="#rr" class="table-of-contents__link toc-highlight">RR</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 MyDevNotebook.com. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>